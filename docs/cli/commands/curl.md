# vercel curl

Execute curl with automatic deployment URL and protection bypass.

## Synopsis

```bash
vercel curl <path> [options] [-- <curl-args>]
```

## Description

The `curl` command simplifies testing your Vercel deployments by automatically:

- Resolving the deployment URL for your linked project
- Handling Vercel Protection bypass authentication
- Passing through any additional curl arguments

This eliminates the need to manually construct URLs and manage protection bypass headers.

## Arguments

| Argument | Required | Description                                  |
| -------- | -------- | -------------------------------------------- |
| `path`   | Yes      | The API path to request (e.g., `/api/hello`) |

The path:

- Can start with `/` or without (both `/api/hello` and `api/hello` work)
- Must be a relative path (not a full URL)
- Is automatically appended to the deployment URL

## Options

| Option                | Type   | Description                                        |
| --------------------- | ------ | -------------------------------------------------- |
| `--deployment`        | String | Target a specific deployment by ID or URL          |
| `--protection-bypass` | String | Protection bypass secret for protected deployments |

### `--deployment`

Target a specific deployment instead of the latest production deployment.

Accepts:

- Deployment ID with prefix: `dpl_ERiL45NJvP8ghWxgbvCM447bmxwV`
- Deployment ID without prefix: `ERiL45NJvP8ghWxgbvCM447bmxwV` (prefix added automatically)
- Full deployment URL: `https://my-project-abc123.vercel.app`

### `--protection-bypass`

Provide a protection bypass secret for deployments with Vercel Protection enabled.

Alternatively, set the `VERCEL_AUTOMATION_BYPASS_SECRET` environment variable.

## Curl Arguments

All arguments after `--` are passed directly to curl:

```bash
vercel curl /api/endpoint -- --header "Content-Type: application/json" --request POST
```

## Examples

### Basic GET Request

```bash
vercel curl /api/hello
```

Equivalent to:

```bash
curl --url https://your-project-abc123.vercel.app/api/hello \
     --header "x-vercel-protection-bypass: <auto-generated-secret>"
```

### POST Request with JSON Data

```bash
vercel curl /api/users -- \
  --request POST \
  --header "Content-Type: application/json" \
  --data '{"name": "John", "email": "john@example.com"}'
```

### Target a Specific Deployment

```bash
# By deployment ID
vercel curl /api/status --deployment ERiL45NJvP8ghWxgbvCM447bmxwV

# With dpl_ prefix
vercel curl /api/status --deployment dpl_ERiL45NJvP8ghWxgbvCM447bmxwV

# By URL
vercel curl /api/status --deployment https://my-project-abc123.vercel.app
```

### Custom Headers and Methods

```bash
vercel curl /api/test -- \
  --request PUT \
  --header "Content-Type: application/json" \
  --header "X-Custom-Header: value" \
  --data '{"updated": true}'
```

### Using Protection Bypass Secret

```bash
vercel curl /api/protected \
  --protection-bypass your-secret-key \
  -- --request GET
```

### Complex Request

```bash
vercel curl /api/webhook -- \
  --request POST \
  --header "Content-Type: application/json" \
  --header "X-Webhook-Signature: sha256=abc123" \
  --data '{
    "event": "user.created",
    "payload": {
      "id": "user_123",
      "email": "new@example.com"
    }
  }'
```

### Save Response to File

```bash
vercel curl /api/export -- --output export.json
```

### Verbose Mode for Debugging

```bash
vercel curl /api/debug -- --verbose
```

---

## How It Works

### 1. Deployment URL Resolution

The target deployment URL is determined:

**With `--deployment` flag:**

- Fetches the specified deployment's URL
- Adds `dpl_` prefix if not provided

**Without `--deployment` flag:**

- Uses the latest deployment from your linked project
- Prefers the most recent production deployment
- Falls back to latest preview deployment if no production exists

### 2. Protection Bypass Handling

For deployments with Vercel Protection enabled:

**Priority order:**

1. `--protection-bypass` flag value
2. `VERCEL_AUTOMATION_BYPASS_SECRET` environment variable
3. Existing automation bypass token from project settings
4. Attempts to create a new automation bypass token via API

### 3. Request Execution

Constructs and executes curl with:

- **Target URL**: `https://<deployment-url><path>`
- **Protection header**: `x-vercel-protection-bypass: <secret>`
- **Your curl args**: All arguments after `--`

---

## Protection Bypass Setup

### Automatic (Recommended)

The command attempts to create an automation bypass token automatically.

### Manual Setup

If automatic creation fails:

1. **Navigate to your project** in the Vercel Dashboard
2. **Go to Settings â†’ Deployment Protection**
3. **Find "Protection Bypass for Automation"**
4. **Generate a new secret**
5. **Use the secret:**

   ```bash
   # With flag
   vercel curl /api/endpoint --protection-bypass your-secret

   # With environment variable
   export VERCEL_AUTOMATION_BYPASS_SECRET=your-secret
   vercel curl /api/endpoint
   ```

---

## CI/CD Integration

### GitHub Actions

```yaml
- name: Test API Endpoint
  env:
    VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
    VERCEL_AUTOMATION_BYPASS_SECRET: ${{ secrets.BYPASS_SECRET }}
  run: |
    vercel link --yes
    vercel curl /api/health -- --fail --silent
```

### Test Script

```bash
#!/bin/bash
# api-test.sh

set -e

echo "Testing health endpoint..."
vercel curl /api/health -- --fail --silent

echo "Testing user endpoint..."
vercel curl /api/users -- \
  --request POST \
  --header "Content-Type: application/json" \
  --data '{"test": true}' \
  --fail

echo "All tests passed!"
```

---

## Troubleshooting

### "curl command not found"

Install curl:

```bash
# macOS
brew install curl

# Ubuntu/Debian
sudo apt-get install curl

# Windows (Chocolatey)
choco install curl
```

### "No deployment found for the project"

Ensure:

- You're in a linked Vercel project directory (`vercel link`)
- The project has at least one deployment

### "Failed to get deployment protection bypass token"

Follow the manual setup steps above to create a protection bypass secret.

### "No deployment found for ID"

- Verify the deployment ID is correct
- Ensure the deployment belongs to your linked project
- Check that the deployment hasn't been deleted

### "Path must be relative (not a full URL)"

Pass only the path (e.g., `/api/hello`), not a full URL. Use `--deployment` to target specific deployments.

---

## See Also

- [httpstat](httpstat.md) - HTTP timing statistics
- [inspect](inspect.md) - Show deployment information
- [logs](logs.md) - View runtime logs
