import type { ProjectContext } from '../types';

export function renderHeader(ctx: ProjectContext): string {
  const timestamp = new Date().toISOString().split('T')[0];
  const frameworkDisplay = ctx.framework || 'Unknown';
  const projectDisplay = ctx.projectName || 'Unnamed Project';

  return `# Vercel Deployment Guide

> Generated by \`vercel agents init\` for **${projectDisplay}**
> Framework: ${frameworkDisplay}
> Generated: ${timestamp}
> Regenerate with: \`vercel agents init --force\`

`;
}

export function renderDeploymentCommands(): string {
  return `## Deployment Commands

| Command | Description |
|---------|-------------|
| \`vercel\` | Deploy to preview environment |
| \`vercel --prod\` | Deploy to production |
| \`vercel logs <url>\` | View deployment logs |
| \`vercel inspect <url>\` | Inspect deployment details |
| \`vercel rollback\` | Rollback to previous deployment |
| \`vercel promote <url>\` | Promote preview to production |

`;
}

export function renderEnvironmentVariables(): string {
  return `## Environment Variables

- Use \`vercel env pull\` to sync environment variables locally
- Use \`vercel env add <name>\` to add new variables
- Use \`vercel env rm <name>\` to remove variables
- Never commit \`.env.local\` or \`.env*.local\` files
- Access via \`process.env.VARIABLE_NAME\` in code

### Environment Targets
- **Production**: Variables for production deployments
- **Preview**: Variables for preview deployments  
- **Development**: Variables for local development

`;
}

export function renderProjectConfig(ctx: ProjectContext): string {
  if (!ctx.vercelConfig) {
    return '';
  }

  const sections: string[] = ['## Project Configuration\n'];
  const config = ctx.vercelConfig;

  if (config.crons && config.crons.length > 0) {
    sections.push('### Configured Cron Jobs\n');
    sections.push('Your project has the following cron jobs configured:\n');
    for (const cron of config.crons) {
      sections.push(`- \`${cron.path}\` runs at \`${cron.schedule}\`\n`);
    }
    sections.push('\n');
  }

  if (config.functions && Object.keys(config.functions).length > 0) {
    sections.push('### Function Configuration\n');
    sections.push('Custom function settings in vercel.json:\n');
    sections.push('```json\n');
    sections.push(JSON.stringify(config.functions, null, 2));
    sections.push('\n```\n\n');
  }

  if (config.rewrites && config.rewrites.length > 0) {
    sections.push(`### Rewrites\n`);
    sections.push(`${config.rewrites.length} rewrite rule(s) configured.\n\n`);
  }

  if (config.redirects && config.redirects.length > 0) {
    sections.push(`### Redirects\n`);
    sections.push(
      `${config.redirects.length} redirect rule(s) configured.\n\n`
    );
  }

  if (config.headers && config.headers.length > 0) {
    sections.push(`### Custom Headers\n`);
    sections.push(
      `${config.headers.length} custom header rule(s) configured.\n\n`
    );
  }

  if (sections.length === 1) {
    return '';
  }

  return sections.join('') + '\n';
}

export function renderFooter(): string {
  return `---

## Custom Rules

Add your project-specific instructions below this line.
These will be preserved when regenerating with \`vercel agents init --force\`.

<!-- CUSTOM RULES START -->

<!-- CUSTOM RULES END -->
`;
}
